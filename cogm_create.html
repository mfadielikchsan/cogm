{% extends "basecogm.html" %}
{% load static %}
{% block content %}
{% load humanize %}
<style>
    .select2-container .select2-selection--single {
        height: 38px;
        font-size: 16px;
        width: 100%;
    }

    .select2-container--default .select2-selection--single {
        padding-top: 5px;
        border-color: #CED4DA;
    }

    .select2-container--default .select2-selection--single .select2-selection__placeholder {
        color: #51585E;
    }

    .select2-container--default .select2-selection--single .select2-selection__arrow {
        margin-top: 5px;
    }

    .sticky {
        background-color: #FFFFFF;
        position: sticky;
        top: 0;
    }

    fieldset 
	{
		border: 1px solid #ddd !important;
		margin: 0;
		xmin-width: 0;
		padding: 10px;       
		position: relative;
		border-radius:4px;
		background-color:#f5f5f5;
		padding-left:10px!important;
	}	
	
    legend
    {
        font-size:14px;
        font-weight:bold;
        margin-bottom: 0px; 
        width: 20%; 
        border: 1px solid #ddd;
        border-radius: 4px; 
        padding: 5px 5px 5px 10px; 
        background-color: #ffffff;
    }
</style>

<div class="container-fluid">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">{{ judul }}</h1>
        <div class="col-md-2">
            <select name="mode" id="mode" class="form-control select2" style="width:100%;" onchange="mode()">
                <option value="0">Simulasi</option>
                <option value="1">Live</option>
            </select>
        </div>
    </div>
    <!-- Content Row -->
    <form method="post" id="form_id">
        {% csrf_token %}
        <div class="col-md-12 row">
            <div class="card shadow mb-4" style="width: 100%;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold">Product</h6>
                    <i class="fa fa-minus" style="cursor: pointer;" id="icard1" data-toggle="collapse" data-target="#collapse1" aria-expanded="false" aria-controls="collapse1"></i>
                </div>
                <div class="collapse show" id="collapse1">
                    <div class="card-body row">
                        <div class="row col-md-12">
                            <div class="col-md-3">
                                <label for="nopro">No Product</label>
                                <select name="nopro" id="nopro" class="form-control select2" style="width:100%;" required onchange="changeProduct('1', this.value)">
                                    <option value=""></option>
                                    {% for produk in all_produk %}
                                        <option value="{{ produk.id_produk}}">{{ produk.no_produk }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="nama">Product Name</label>
                                <select name="nama" id="nama" class="form-control select2" style="width:100%;" required onchange="changeProduct('2', this.value)">
                                    <option value=""></option>
                                    {% for produk in all_produk %}
                                        <option value="{{ produk.id_produk}}">{{ produk.nama_produk }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="history">History - Revisi</label>
                                <select name="history" id="history" class="form-control select2" style="width:100%;" onchange="changeHistory()">
                                    <option value=""></option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="approve">Status Approve</label>
                                <input class="form-control" type="text" name="approve" id="approve" readonly style="font-weight: bold;">
                            </div>
                        </div>
                        <div style="width: 100%;" class="col-md-12 mt-3 row">
                            <div class="col-md-3">
                                <label for="nosap">No Sap</label>
                                <input type="text" class="form-control" id="nosap" name="nosap" readonly>
                            </div>
                            <div class="col-md-3">
                                <label for="pelanggan">Customer</label>
                                <input type="text" class="form-control" id="pelanggan" name="pelanggan" readonly>
                            </div>
                            <div class="col-md-3">
                                <label for="tipe">Product Type</label>
                                <input type="text" class="form-control" id="tipe" name="tipe" readonly>
                            </div>
                            <div class="col-md-3">
                                <label for="quantity">Quantity</label>
                                <div class="row col-md-12">
                                    <input type="text" class="form-control col-md-10" id="quantity" name="quantity" readonly>
                                    <a href="" class="col-md-2" id="hreffile"><button type="button" class="btn btn-success"><i class="fa fa-download" aria-hidden="true"></i></button></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4" style="width: 100%;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold">General Overview</h6>
                    <i class="fa fa-minus" style="cursor: pointer;" id="icard2" data-toggle="collapse" data-target="#collapse2" aria-expanded="false" aria-controls="collapse2"></i>
                </div>
                <div class="collapse show" id="collapse2">
                    <div class="card-body">
                        <fieldset class="row mx-2">    	
                            <legend>Product Cost</legend>
                            <div class="col-md-12 row pb-3">
                                <div class="col-md-3">
                                    <label for="materialcost">Material Cost</label>
                                    <input type="text" class="form-control" id="materialcost" name="materialcost" readonly>
                                </div>
                                <div class="col-md-3">
                                    <label for="processcost">Process Cost</label>
                                    <input type="text" class="form-control" id="processcost" name="processcost" readonly>
                                </div>
                                <div class="col-md-3">
                                    <label style="font-weight:bold" style="font-weight:bold" for="productcost">Total Product Cost</label>
                                    <input style="font-weight:bold" style="font-weight:bold" type="text" class="form-control" id="productcost" name="productcost" readonly>
                                </div>
                            </div>
                        </fieldset>	
                        <fieldset class="row mx-2 mt-3">    	
                            <legend>Depreciate Cost</legend>
                            <div class="col-md-12 row pb-3">
                                <div class="col-md-3">
                                    <label for="deprecost">Tooling Cost</label>
                                    <input type="text" class="form-control" id="deprecost" name="deprecost" readonly>
                                </div>
                                <div class="col-md-3">
                                    <span class="row" style="width: 100%; margin-left: 1px;">
                                        <label for="maintenancecost">Maintenance Cost</label> <input style="width: 20px; margin-left: 8px; margin-top: -5px;" type="checkbox" class="form-control" value="1" name="chckdmaintenance" id="chckdmaintenance" checked onchange="calculateCostInvestment()">
                                    </span>
                                    <input type="text" class="form-control" id="maintenancecost" name="maintenancecost" readonly>
                                </div>
                                <div class="col-md-3">
                                    <span class="row" style="width: 100%; margin-left: 1px;">
                                        <label for="trialcost">Trial Cost</label> <input style="width: 20px; margin-left: 8px; margin-top: -5px;" type="checkbox" class="form-control" value="1" name="chckdtrial" id="chckdtrial" checked onchange="calculateTotalCost()">
                                    </span>
                                    <input type="text" class="form-control" id="trialcost" name="trialcost" readonly>
                                </div>
                                <div class="col-md-3">
                                    <label style="font-weight:bold" for="totaldepre">Total Depreciate Cost</label>
                                    <input style="font-weight:bold" type="text" class="form-control" id="totaldepre" name="totaldepre" readonly>
                                </div>
                            </div>
                        </fieldset>		
                        <fieldset class="row mx-2 mt-3">    	
                            <legend>Other Cost</legend>
                            <div class="col-md-12 row pb-3">
                                <div class="col-md-3">
                                    <label for="nondeprecost">Investment Non Depreciate</label>
                                    <input type="text" class="form-control" id="nondeprecost" name="nondeprecost" readonly>
                                </div>
                                <div class="col-md-3">
                                    <label for="rejectpercent">Reject Cost %</label>
                                    <input type="number" class="form-control" id="rejectpercent" name="rejectpercent" onchange="calculateTotalCost()" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="rejectcost">Reject Cost</label>
                                    <input type="text" class="form-control" id="rejectcost" name="rejectcost" readonly>
                                </div>
                            </div>
                        </fieldset>			
                        <div class="col-md-12 row mt-3">
                            <div class="col-md-3">
                                <label for="totalcost" style="font-weight:bold">Total Cost</label>
                                <input type="text" style="font-weight:bold" class="form-control" id="totalcost" name="totalcost" readonly>
                            </div>
                            <div style="margin-top: 32px; margin-right: 15px;">
                                <button type="button" class="btn btn-danger" onclick="pdfCogm()"><i class="fa fa-download"></i> To PDF</button>
                            </div>
                            <div style="margin-top: 32px;">
                                <button type="button" class="btn btn-success" onclick="excelCogm()"><i class="fa fa-download"></i> To Excel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4" style="width: 100%;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold">Change Information</h6>
                    <i class="fa fa-minus" style="cursor: pointer;" id="icard3" data-toggle="collapse" data-target="#collapse3" aria-expanded="false" aria-controls="collapse3"></i>
                </div>
                <div class="collapse show" id="collapse3">
                    <div class="card-body">
                        <textarea class="form-control" name="ketchange" id="ketchange" rows="2" required></textarea>
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4" style="width: 100%;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold">Exchange Rate</h6>
                    <i class="fa fa-minus" style="cursor: pointer;" id="icard4" data-toggle="collapse" data-target="#collapse4" aria-expanded="false" aria-controls="collapse4"></i>
                </div>
                <div class="collapse show" id="collapse4">
                    <div class="card-body row" id="divcurrency">
                        {% for currency in all_currency %}
                        <div class="col-md-3">
                            <label>{{ currency.kode_mata_uang}}</label>
                            <input type="hidden" name="kdcurr[]" value="{{ currency.kode_mata_uang}}">
                            <input type="text" name="currp[]" class="form-control" readonly value="{{ currency.rupiah|floatformat:2|intcomma }}">
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4" style="width: 100%;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold">PI Component</h6>
                    <i class="fa fa-minus" style="cursor: pointer;" id="icard5" data-toggle="collapse" data-target="#collapse5" aria-expanded="false" aria-controls="collapse5"></i>
                </div>
                <div class="collapse show" id="collapse5">
                    <div class="card-body">
                        <button type="button" style="width:15%;" class="btn btn-primary" onclick="addComponen1()"><i class="fa fa-plus"></i> Add Component</button> 
                        <div style="overflow-x: scroll; max-height: 450px; margin-top: 5px;">
                            <table class="table mt-3" id="tableAddComponen1">
                                <thead>
                                    <tr>
                                        <th class="sticky" style="text-align:center; width:3%;">No</th> 
                                        <th class="sticky" style="text-align: center; width: 60%; z-index: 5;">Componen</th>
                                        <th class="sticky" style="text-align: center;">Cost Componen</th>
                                        <th class="sticky" style="text-align: center;width: 8%;">Detail</th>
                                        <th class="sticky" style="text-align: center;width: 8%;">Delete</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyComponen1">
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4" style="width: 100%;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold">Component</h6>
                    <i class="fa fa-minus" style="cursor: pointer;" id="icard6" data-toggle="collapse" data-target="#collapse6" aria-expanded="false" aria-controls="collapse6"></i>
                </div>
                <div class="collapse show" id="collapse6">
                    <div class="card-body">
                        <button type="button" style="width:15%;" class="btn btn-primary" onclick="addComponen2()"><i class="fa fa-plus"></i> Add Component</button> 
                        <div class="table-responsive" style="max-height: 450px; margin-top: 5px;">
                            <table class="table mt-3 tab" id="tableAddComponen2" style="min-width:1350px;">
                                <thead>
                                    <tr>
                                        <th class="sticky" style="text-align:center; width:3%;">No</th> 
                                        <th class="sticky" style="text-align: center; width: 40%; z-index: 5;">Componen</th>
                                        <th class="sticky" style="text-align: center; width: 8%;">Usage</th>
                                        <th class="sticky" style="text-align: center; width: 8%;">Unit</th>
                                        <th class="sticky" style="text-align: center;">Rp / Unit</th>
                                        <th class="sticky" style="text-align: center;">Rp / Part</th>
                                        <th class="sticky" style="text-align: center; width: 15%">Update Date</th>
                                        <th class="sticky" style="text-align: center; width: 5%;">Delete</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyComponen2">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4" style="width: 100%;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold">Additional Process Cost</h6>
                    <i class="fa fa-minus" style="cursor: pointer;" id="icard7" data-toggle="collapse" data-target="#collapse7" aria-expanded="false" aria-controls="collapse7"></i>
                </div>
                <div class="collapse show" id="collapse7">
                    <div class="card-body">

                        <h5>Finishing</h5>
                        <button type="button" style="width:15%; margin-top: 10px;" class="btn btn-primary" onclick="addFinishing()"><i class="fa fa-plus"></i> Add Process</button> 
                        <div style="overflow-x: scroll; max-height: 450px; margin-top: 5px;">
                            <table class="table mt-3" id="tableAddFinishing">
                                <thead>
                                    <tr>
                                        <th class="sticky" style="text-align:center; width:3%;">No</th> 
                                        <th class="sticky" style="text-align: center; width: 45%;">Process Name</th>
                                        <th class="sticky" style="text-align: center; width: 10%;">Man Power</th>
                                        <th class="sticky" style="text-align: center; width: 10%;">Cycle Time</th>
                                        <th class="sticky" style="text-align: center;">Rp / Sec</th>
                                        <th class="sticky" style="text-align: center;">Rp / Part</th>
                                        <th class="sticky" style="text-align: center; width: 7%;">Delete</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyFinishing">
            
                                </tbody>
                            </table>
                        </div>
                        <hr>

                        <h5>Assembly</h5>
                        <button type="button" style="width:15%; margin-top: 10px;" class="btn btn-primary" onclick="addAssembly()"><i class="fa fa-plus"></i> Add Process</button> 
                        <div style="overflow-x: scroll; max-height: 450px; margin-top: 5px;">
                            <table class="table mt-3" id="tableAddAssembly">
                                <thead>
                                    <tr>
                                        <th class="sticky" style="text-align:center; width:3%;">No</th>
                                        <th class="sticky" style="text-align: center; width: 45%;">Process Name</th>
                                        <th class="sticky" style="text-align: center; width: 10%;">Man Power</th>
                                        <th class="sticky" style="text-align: center; width: 10%;">Cycle Time</th>
                                        <th class="sticky" style="text-align: center;">Rp / Sec</th>
                                        <th class="sticky" style="text-align: center;">Rp / Part</th>
                                        <th class="sticky" style="text-align: center; width: 7%;">Delete</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyAssembly">
            
                                </tbody>
                            </table>
                        </div>
                        <hr>

                        <h5>Packaging</h5>
                        <button type="button" style="width:15%; margin-top: 10px;" class="btn btn-primary" onclick="addPackaging()"><i class="fa fa-plus"></i> Add Process</button> 
                        <div style="overflow-x: scroll; max-height: 450px; margin-top: 5px;">
                            <table class="table mt-3" id="tableAddPackaging">
                                <thead>
                                    <tr>
                                        <th class="sticky" style="text-align:center; width:3%;">No</th>
                                        <th class="sticky" style="text-align: center; width: 45%;">Process Name</th>
                                        <th class="sticky" style="text-align: center; width: 10%;">Man Power</th>
                                        <th class="sticky" style="text-align: center; width: 10%;">Cycle Time</th>
                                        <th class="sticky" style="text-align: center;">Rp / Sec</th>
                                        <th class="sticky" style="text-align: center;">Rp / Part</th>
                                        <th class="sticky" style="text-align: center; width: 7%;">Delete</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyPackaging">
            
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>

            <div class="card shadow mb-4" style="width: 100%;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold">Additional Item Investment</h6>
                    <i class="fa fa-minus" style="cursor: pointer;" id="icard8" data-toggle="collapse" data-target="#collapse8" aria-expanded="false" aria-controls="collapse8"></i>
                </div>
                <div class="collapse show" id="collapse8">
                    <div class="card-body">
                        <h5>Investment (Mold)</h5>
                        <button type="button" style="width:15%;" class="btn btn-primary" onclick="addInvestment1()"><i class="fa fa-plus"></i> Add Item</button> 
                        <div style="overflow-x: scroll; max-height: 450px; margin-top: 5px;">
                            <table class="table mt-3" id="tableAddInvestment1">
                                <thead>
                                    <tr>
                                        <th class="sticky" style="text-align:center; width:3%;">No</th>
                                        <th class="sticky" style="text-align: center; width: 5%;">Deprec</th>
                                        <th class="sticky" style="text-align: center; width: 35%;">Item Investment</th>
                                        <th class="sticky" style="text-align: center;">Price</th>
                                        <th class="sticky" style="text-align: center;">Total Prod</th>
                                        <th class="sticky" style="text-align: center; width: 8%;">Cavity</th>
                                        <th class="sticky" style="text-align: center; ">Rp / Part</th>
                                        <th class="sticky" style="text-align: center; width: 5%;">Delete</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyInvestment1">
                                    
                                </tbody>
                            </table>
                        </div>
                        <hr>
                        <h5>Investment (Non Mold)</h5>
                        <button type="button" style="width:15%;" class="btn btn-primary" onclick="addInvestment2()"><i class="fa fa-plus"></i> Add Item</button> 
                        <div style="overflow-x: scroll; max-height: 450px; margin-top: 5px;">
                            <table class="table mt-3" id="tableAddInvestment2">
                                <thead>
                                    <tr>
                                        <th class="sticky" style="text-align:center; width:3%;">No</th>
                                        <th class="sticky" style="text-align: center; width: 5%;">Deprec</th>
                                        <th class="sticky" style="text-align: center; width: 35%;">Item Investment</th>
                                        <th class="sticky" style="text-align: center;">Price</th>
                                        <th class="sticky" style="text-align: center;">Total Prod</th>
                                        <th class="sticky" style="text-align: center; width: 8%;">Quantity</th>
                                        <th class="sticky" style="text-align: center; ">Rp / Part</th>
                                        <th class="sticky" style="text-align: center; width: 5%;">Delete</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyInvestment2">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4" style="width: 100%;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold">Approval</h6>
                    <i class="fa fa-minus" style="cursor: pointer;" id="icard9" data-toggle="collapse" data-target="#collapse9" aria-expanded="false" aria-controls="collapse9"></i>
                </div>
                <div class="collapse show" id="collapse9">
                    <div class="card-body">		
                        <div class="col-md-12 row">
                            <div class="col-md-3">
                                <label for="namadepthead">Dept Head Name</label>
                                <input type="text" class="form-control" id="namadepthead" name="namadepthead" required readonly>
                            </div>
                            <div class="col-md-3">
                                <label for="emaildepthead">Dept Head Email</label>
                                <input type="text" class="form-control" id="emaildepthead" name="emaildepthead" required readonly>
                            </div>
                            <div class="col-md-3">
                                <label for="namadivhead">Div Head Name</label>
                                <input type="text" class="form-control" id="namadivhead" name="namadivhead" required readonly>
                            </div>
                            <div class="col-md-3">
                                <label for="emaildivhead">Div Head Email</label>
                                <input type="text" class="form-control" id="emaildivhead" name="emaildivhead" required readonly>
                            </div>
                        </div>
                        <div class="col-md-12 row mt-3">
                            <div class="col-md-3">
                                <label for="namapresdir">Presdir Name</label>
                                <input type="text" class="form-control" id="namapresdir" name="namapresdir" required readonly>
                            </div>
                            <div class="col-md-3">
                                <label for="emailpresdir">Presdir Email</label>
                                <input type="text" class="form-control" id="emailpresdir" name="emailpresdir" required readonly>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="divbtn">
                <button type="button" class="btn btn-secondary">Close</button>
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </div>
    </form>
</div>

<!-- Modal Pi -->
<div class="modal fade" id="modalPi">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title"><span id="headpi"></span></h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
            <!-- Form untuk input data PI Componen -->
            <div class="row">
                <div class="form-group col-md-3">
                    <label for="tonnage">Tonnage Machine</label>
                    <input type="number" class="form-control" name="tonnage" id="tonnage" autocomplete="off" readonly>
                </div>
                <div class="form-group col-md-3">
                    <label for="cycletime">Cycle Time</label>
                    <input type="number" class="form-control" name="cycletime" id="cycletime" autocomplete="off" readonly>
                </div>
                <div class="form-group col-md-3">
                    <label for="costmesin">Machine Cost</label>
                    <input type="text" class="form-control" name="costmesin" id="costmesin" autocomplete="off" readonly>
                </div>
                <div class="form-group col-md-3">
                    <label for="costcooling">Cooling Cost</label>
                    <input type="text" class="form-control" name="costcooling" id="costcooling" autocomplete="off" readonly>
                </div>
                <div class="form-group col-md-3">
                    <label for="cavitypi">Cavity</label>
                    <input type="text" class="form-control" name="cavitypi" id="cavitypi" autocomplete="off" readonly>
                </div>
                <div class="form-group col-md-3">
                    <label for="usagepi">Usage (KG)</label>
                    <input type="text" class="form-control" name="usagepi" id="usagepi" autocomplete="off" readonly>
                </div>
                <div class="form-group col-md-3">
                    <label for="period">Cost Material Period</label>
                    <input type="text" class="form-control" name="period" id="period" autocomplete="off" readonly>
                </div>
            </div>
                <table class="table mt-3" id="tableMaterial">
                    <thead>
                        <tr>
                            <th style="text-align: center; width: 40%;">Material</th>
                            <th style="text-align: center; width: 10%;">%</th>
                            <th style="text-align: center;">Usage (KG)</th>
                            <th style="text-align: center;">Rp/KG</th>
                            <th style="text-align: center;">Rp/Part</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyMaterial">

                    </tbody>
                </table>
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() { 
        function setupCollapse(collapseId, icardId) {
            $(collapseId).on('hidden.bs.collapse', function () {
                $(icardId).removeClass('fa-minus').addClass('fa-plus');
            });
            $(collapseId).on('shown.bs.collapse', function () {
                $(icardId).removeClass('fa-plus').addClass('fa-minus');
            });
            $('#divbtn').hide();
            $("#hreffile").hide()
        }

        setupCollapse('#collapse1', '#icard1');
        setupCollapse('#collapse2', '#icard2');
        setupCollapse('#collapse3', '#icard3');
        setupCollapse('#collapse4', '#icard4');
        setupCollapse('#collapse5', '#icard5');
        setupCollapse('#collapse6', '#icard6');
        setupCollapse('#collapse7', '#icard7');
        setupCollapse('#collapse8', '#icard8');
        setupCollapse('#collapse9', '#icard9');

        document.getElementById("form_id").addEventListener("submit", (e) => {
            e.preventDefault();
            validate();
        });
        $("body").css("background-color", "lightblue");
    });

    function mode() {
        //mode 0 = simulasi, 1 = live
        let mode =  $("#mode").val();
        let history = $("#history").val();

        if(mode == '0') {
            if(history == 'UPD') {
                $('[name="componen[]"]').prop('readonly', false);
                $('[name="componen[]"]').prop('disabled', false);
            }else{
                $('[name="componen[]"]').prop('readonly', false);
                $('[name="componen[]"]').prop('disabled', false);
            }
            $('#divbtn').hide();
            $('#ketchange').prop('readonly', true);
            $("body").css("background-color", "lightblue");
        }else{
            if (history == 'UPD') {
                $('#divbtn').show();
                $('#ketchange').prop('readonly', false);
            } else {
                $('#divbtn').hide();
                $('#ketchange').prop('readonly', true);
            }
            $("body").css("background-color", "#F08080");
        }
    }

    function changeProduct(id, val) {
        if (id == '1' && $("#nama").val() !== val) {
            $("#nama").val(val).change();
            getProduct(val);
        } else if (id == '2' && $("#nopro").val() !== val) {
            $("#nopro").val(val).change();
            getProduct(val);
        }
    }

    function getProduct(id) {
        let url = '{% url 'COGM:get_cogm' 'param1'%}';
        url = url.replace('param1', btoa(id));
        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                const history=$('#history')
                let strHtml=""
                strHtml+=`
                    <option value="UPD">Update</option>
                ` 
                data.history.forEach((el,i)=>{
                    strHtml+=`
                        <option value="${formatTanggalVal(el.dtcrea)}" ${i == '0' ? 'selected' : ''}>${formatTanggal(el.dtcrea)} - ${el.rev}</option>
                    `                    
                })
                history.html(strHtml);
                changeHistory();
            }
        });
    }

    function changeHistory() {
        let id = $("#nama").val();
        let history = $("#history").val();
        let url = '{% url 'COGM:history_cogm' 'param1' 'param2'%}';
        url = url.replace('param1', btoa(id));
        url = url.replace('param2', btoa(history));
        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                console.log(data);
                $('#nosap').val(data.produk.no_sap);
                $('#pelanggan').val(data.produk.pelanggan);
                $('#tipe').val(data.produk.tipe);
                $('#quantity').val(formatNumberWithCommas(data.produk.quantity));
                if(data.produk.uploaded_file){
                    let id = btoa(data.produk.id_produk)
                    let yourUrl = "/COGM/downloadfile-product/"+id
                    $("#hreffile").attr("href", yourUrl);
                    $("#hreffile").show()
                }else{
                    $("#hreffile").hide()
                }
                if(data.cekupd != 'NULL') {
                    if(data.cekupd == 'NO') {
                        $('#materialcost').val(formatNumberWithCommas(data.cogm.material_cost));
                        $('#processcost').val(formatNumberWithCommas(data.cogm.process_cost));
                        $('#productcost').val(formatNumberWithCommas(data.cogm.product_cost));
                        $('#deprecost').val(formatNumberWithCommas(data.cogm.depreciate_cost));
                        $('#nondeprecost').val(formatNumberWithCommas(data.cogm.nondepreciate_cost));
                        $('#maintenancecost').val(formatNumberWithCommas(data.cogm.maintenance_cost));
                        $('#trialcost').val(formatNumberWithCommas(data.cogm.trial_cost));
                        $('#totaldepre').val(formatNumberWithCommas(data.cogm.totaldepre_cost));
                        $('#rejectpercent').val(formatNumberWithCommas(data.cogm.reject_percent));
                        $('#rejectcost').val(formatNumberWithCommas(data.cogm.reject_cost));
                        $('#totalcost').val(formatNumberWithCommas(data.cogm.total_cost));
                        $('#ketchange').val(data.cogm.change_information);

                        if(data.cogm.presdir_approval) {
                            $('#approve').val(data.cogm.presdir_approval+' Presdir');
                            if(data.cogm.presdir_approval == 'Approved') {
                                $('#approve').css('color', 'green');
                            }else if(data.cogm.presdir_approval == 'Rejected') {
                                $('#approve').css('color', 'red');
                            }else{
                                $('#approve').css('color', '');
                            }
                        }else if(data.cogm.divhead_approval){
                            $('#approve').val(data.cogm.divhead_approval+' Div Head');
                            if(data.cogm.divhead_approval == 'Approved') {
                                $('#approve').css('color', 'green');
                            }else if(data.cogm.divhead_approval == 'Rejected') {
                                $('#approve').css('color', 'red');
                            }else{
                                $('#approve').css('color', '');
                            }
                        }else if(data.cogm.depthead_approval){
                            $('#approve').val(data.cogm.depthead_approval+' Dept Head');
                            if(data.cogm.depthead_approval == 'Approved') {
                                $('#approve').css('color', 'green');
                            }else if(data.cogm.depthead_approval == 'Rejected') {
                                $('#approve').css('color', 'red');
                            }else{
                                $('#approve').css('color', '');
                            }
                        }else{
                            $('#approve').val('');
                            $('#approve').css('color', '');
                        }
                    }else{
                        $('#materialcost').val('');
                        $('#processcost').val('');
                        $('#productcost').val('');
                        $('#deprecost').val('');
                        $('#nondeprecost').val('');
                        $('#maintenancecost').val('');
                        $('#trialcost').val('');
                        $('#totaldepre').val('');
                        $('#totalcost').val('');
                        $('#ketchange').val('');
                        $('#approve').val('');
                        $('#approve').css('color', '');
                        calculateMaterialCost();
                        calculateProcessCost();
                        calculateCostInvestment();
                        calculateCostMaintenance();
                        calculateTotalCost();
                    }

                    if(data.cogm.checked_maintenance == '1') {
                        $('#chckdmaintenance').prop('checked', true);
                    }else{
                        $('#chckdmaintenance').prop('checked', false);
                    }

                    if(data.cogm.checked_trial == '1') {
                        $('#chckdtrial').prop('checked', true);
                    }else{
                        $('#chckdtrial').prop('checked', false);
                    }

                    const divcurrency=$('#divcurrency')
                    let strdivcurrency=""
                    data.excrate.forEach((el,i)=>{
                        strdivcurrency += `<div class="col-md-3">
                                                <label>${el.kode_mata_uang}</label>
                                                <input type="hidden" name="kdcurr[]" value="${el.kode_mata_uang}">
                                                <input type="text" name="currp[]" class="form-control" readonly value="${formatNumberWithCommas(el.rupiah)}">
                                            </div>`                 
                    })
                    divcurrency.html(strdivcurrency);

                    const tbodypicomp=$('#tbodyComponen1')
                    let strHtmlPiComp=""
                    data.picomp.forEach((el,i)=>{
                        strHtmlPiComp += `<tr id="tr_pi_${i+1}" class="form-tr-pi">  
                                            <td style="text-align: center;" id="no_picomp${i+1}">${i+1}</td>  
                                            <td style="width:30%;">
                                                <select name="pi[]" id="pi${i+1}" class="form-control select2" style="width:100%" onchange="calculateCostPi(${i+1})" required>
                                                    <option value=""></option>
                                                    {% for piin in all_piin %}
                                                        <option value="{{ piin.id_pi_comp}}" cycle_time="{{ piin.cycle_time}}" cost="{{ piin.cost_total}}" mesin="{{ piin.cost_mesin}}" cooling="{{ piin.cost_cooling}}" tonage="{{ piin.tonage}}" process="{{ piin.cost_process}}" material="{{ piin.cost_material}}"
                                                        ${el.id_picomp == '{{ piin.id_pi_comp }}' ? 'selected' : ''}
                                                        >{{ piin.nama_pi_comp }}</option>
                                                    {% endfor %}
                                                </select>
                                            </td>
                                            <td><input type="text" name="costpi[]" id="costpi${i+1}" value="${formatNumberWithCommas(el.costpi)}" class="form-control text-right" readonly></td>
                                            <td class="dt-center">
                                                <center><button type="button" class="btn btn-xs btn-primary" id="btndetpi_${i+1}" onclick="getDetailPI(${i+1})"><i class="fa fa-info-circle"></i></button></center>
                                            </td>
                                            <td class="dt-center">
                                                <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_pi_${i+1}" onclick="deleteRowPi(${i+1})"><i class="fa fa-trash"></i></button></center>
                                            </td>
                                        </tr>`                 
                    })
                    tbodypicomp.html(strHtmlPiComp);
    
                    const tbodycomp=$('#tbodyComponen2')
                    let strHtmlComp=""
                    data.comp.forEach((el,i)=>{
                        strHtmlComp += `<tr class="form-tr-comp">    
                                <td style="text-align: center;" id="no_comp${i+1}">${i+1}</td>
                                <td>
                                    <select name="componen[]" id="componen${i+1}" class="form-control select2" style="width:100%" onchange="calculateCostComponen(${i+1})" ${data.cekupd == 'NO' ? 'readonly disabled' : ''}>
                                        <option value=""></option>
                                        {% for komp in all_komp %}
                                            <option value="{{ komp.id_component}}" cost="{{ komp.rupiah_harga}}" unit="{{ komp.satuan}}" dtmody="{{ komp.dtmody }}"
                                            ${el.id_component == '{{ komp.id_component }}' ? 'selected' : ''}
                                            >{{ komp.nama_component }}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td><input type="text" name="usagec[]" id="usagec${i+1}" class="form-control text-center" onkeyup="formatInput(this)" autocomplete="off" oninput="calculateCostComponen(${i+1})" value="${formatNumberWithCommas(el.usage)}"></td>
                                <td><input type="text" name="unitc[]" id="unitc${i+1}" class="form-control text-center" readonly value="${el.unit}"></td>
                                <td><input type="text" name="rpunitc[]" id="rpunitc${i+1}" class="form-control text-right" readonly value="${data.cekupd == 'NO' ? formatNumberWithCommas(el.rpunit) : formatNumberWithCommas(parseFloat(el.rpunitnew).toFixed(2))}"></td>
                                <td><input type="text" name="rppartc[]" id="rppartc${i+1}"  class="form-control text-right" readonly value="${data.cekupd == 'NO' ? formatNumberWithCommas(el.rppart) : formatNumberWithCommas(parseFloat(el.rppartnew).toFixed(2))}"></td>
                                <td><input type="text" name="updatec[]" id="updatec${i+1}" class="form-control text-center" readonly value="${data.cekupd == 'NO' ? formatTanggal(el.datecost) : formatTanggal(el.dtmody) }"></td>
                                <td class="dt-center">
                                    <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_comp_${i+1}" onclick="deleteRowComp(${i+1})"><i class="fa fa-trash"></i></button></center>
                                </td>
                            </tr>`                 
                    })
                    tbodycomp.html(strHtmlComp);

                    const tbodyFin=$('#tbodyFinishing')
                    let strHtmlFin=""
                    data.process_finishing.forEach((el,i)=>{
                        strHtmlFin += `<tr id="tr_f_${i+1}" class="form-tr-f">
                                        <td style="text-align: center;" id="no_process_f_${i+1}">${i+1}</td>     
                                        <td><input type="text" name="fprocess[]" id="fprocess${i+1}" class="form-control" autocomplete="off" onkeyup="this.value = this.value.toUpperCase();" value="${el.name}"></td>
                                        <td><input type="number" name="fmp[]" id="fmp${i+1}" class="form-control text-center" onchange="costProcess('f', ${i+1})" required value="${el.manpower}"></td>
                                        <td><input type="text" name="fct[]" id="fct${i+1}" class="form-control text-center" onkeyup="formatInput(this)" onchange="costProcess('f', ${i+1})" required value="${formatNumberWithCommas(el.cycletime)}"></td>
                                        <td><input type="text" name="frpsec[]" id="frpsec${i+1}"  class="form-control text-center" onkeyup="formatInput(this)" onchange="costProcess('f', ${i+1})" required value="${formatNumberWithCommas(el.rpsec)}"></td>
                                        <td><input type="text" name="frppart[]" id="frppart${i+1}"  class="form-control text-right" readonly value="${formatNumberWithCommas(el.rppart)}"></td>
                                        <td class="dt-center">
                                            <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_process_f_${i+1}" onclick="deleteRowProcess('f', ${i+1})"><i class="fa fa-trash"></i></button></center>
                                        </td>
                                    </tr>`                 
                    })
                    tbodyFin.html(strHtmlFin);

                    const tbodyAsy=$('#tbodyAssembly')
                    let strHtmlAsy=""
                    data.process_assembly.forEach((el,i)=>{
                        strHtmlAsy += `<tr id="tr_a_${i+1}" class="form-tr-f">
                                        <td style="text-align: center;" id="no_process_a_${i+1}">${i+1}</td>     
                                        <td><input type="text" name="aprocess[]" id="aprocess${i+1}" class="form-control" autocomplete="off" onkeyup="this.value = this.value.toUpperCase();" required value="${el.name}"></td>
                                        <td><input type="number" name="amp[]" id="amp${i+1}" class="form-control text-center" onchange="costProcess('a', ${i+1})" required value="${el.manpower}"></td>
                                        <td><input type="text" name="act[]" id="act${i+1}" class="form-control text-center" onkeyup="formatInput(this)" onchange="costProcess('a', ${i+1})" required value="${formatNumberWithCommas(el.cycletime)}"></td>
                                        <td><input type="text" name="arpsec[]" id="arpsec${i+1}"  class="form-control text-center" onkeyup="formatInput(this)" onchange="costProcess('a', ${i+1})" required value="${formatNumberWithCommas(el.rpsec)}"></td>
                                        <td><input type="text" name="arppart[]" id="arppart${i+1}"  class="form-control text-right" readonly value="${formatNumberWithCommas(el.rppart)}"></td>
                                        <td class="dt-center">
                                            <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_process_a_${i+1}" onclick="deleteRowProcess('a', ${i+1})"><i class="fa fa-trash"></i></button></center>
                                        </td>
                                    </tr>`                 
                    })
                    tbodyAsy.html(strHtmlAsy);

                    const tbodyPac=$('#tbodyPackaging')
                    let strHtmlPac=""
                    data.process_packaging.forEach((el,i)=>{
                        strHtmlPac += `<tr id="tr_p_${i+1}" class="form-tr-f">
                                        <td style="text-align: center;" id="no_process_p_${i+1}">${i+1}</td>     
                                        <td><input type="text" name="pprocess[]" id="pprocess${i+1}" class="form-control" autocomplete="off" onkeyup="this.value = this.value.toUpperCase();" required value="${el.name}"></td>
                                        <td><input type="number" name="pmp[]" id="pmp${i+1}" class="form-control text-center" onchange="costProcess('p', ${i+1})" required value="${el.manpower}"></td>
                                        <td><input type="text" name="pct[]" id="pct${i+1}" class="form-control text-center" onkeyup="formatInput(this)" onchange="costProcess('p', ${i+1})" required value="${formatNumberWithCommas(el.cycletime)}"></td>
                                        <td><input type="text" name="prpsec[]" id="prpsec${i+1}"  class="form-control text-center" onkeyup="formatInput(this)" onchange="costProcess('p', ${i+1})" required value="${formatNumberWithCommas(el.rpsec)}"></td>
                                        <td><input type="text" name="prppart[]" id="prppart${i+1}"  class="form-control text-right" readonly value="${formatNumberWithCommas(el.rppart)}"></td>
                                        <td class="dt-center">
                                            <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_process_p_${i+1}" onclick="deleteRowProcess('p', ${i+1})"><i class="fa fa-trash"></i></button></center>
                                        </td>
                                    </tr>`                 
                    })
                    tbodyPac.html(strHtmlPac);

                    const tbodyInv1=$('#tbodyInvestment1')
                    let strHtmlInv1=""
                    data.investment_mold.forEach((el,i)=>{
                        strHtmlInv1 +=`<tr class="form-tr-investment1">
                                        <input type="hidden" class="form-control" id="1valiteminvest${i+1}" name="valiteminvest1[]" value="${el.checked}">
                                        <td style="text-align: center;" id="no_investment_1_${i+1}">${i+1}</td>     
                                        <td class="dt-center">
                                            <center><input class="form-control" style="width:60%" type="checkbox" id="1chckitem${i+1}" name="chckitem1[]" ${el.checked == '1' ? 'checked' : ''}  onchange="updateCheckboxValue(this, ${i+1}, 1)"></center>
                                        </td>
                                        <td><input type="text" class="form-control" id="1iteminvest${i+1}" name="iteminvest1[]" value="${el.item}" onkeyup="this.value = this.value.toUpperCase();"></td>
                                        <td><input type="text" class="form-control text-right" id="1priceinvest${i+1}" name="priceinvest1[]" value="${formatNumberWithCommas(el.price)}" onkeyup="formatInput(this)" onchange="priceInvestment(${i+1}, 1)"></td>
                                        <td><input type="text" class="form-control text-right" id="1totprodinvest${i+1}" name="totprodinvest1[]" value="${formatNumberWithCommas(el.totalprod)}" onkeyup="formatInput(this)" onchange="priceInvestment(${i+1}, 1)"></td>
                                        <td><input type="number" class="form-control text-center" id="1cavityinvest${i+1}" name="cavityinvest1[]" value="${el.quantity}" onchange="priceInvestment(${i+1}, 1)" value="1"></td>
                                        <td><input type="text" class="form-control text-right" id="1rppartinvest${i+1}" name="rppartinvest1[]" value="${formatNumberWithCommas(el.rppart)}" readonly></td>
                                        <td class="dt-center">
                                            <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_investment_1_${i+1}" onclick="deleteRowInvestment('1', '${i+1}')"><i class="fa fa-trash"></i></button></center>
                                        </td>
                                    </tr>`              
                    })
                    tbodyInv1.html(strHtmlInv1);

                    const tbodyInv2=$('#tbodyInvestment2')
                    let strHtmlInv2=""
                    data.investment_non.forEach((el,i)=>{
                        strHtmlInv2 +=`<tr class="form-tr-investment2">
                                        <input type="hidden" class="form-control" id="2valiteminvest${i+1}" name="valiteminvest2[]" value="${el.checked}">
                                        <td style="text-align: center;" id="no_investment_2_${i+1}">${i+1}</td>     
                                        <td class="dt-center">
                                            <center><input class="form-control" style="width:60%" type="checkbox" id="2chckitem${i+1}" name="chckitem2[]" ${el.checked == '1' ? 'checked' : ''}  onchange="updateCheckboxValue(this, ${i+1}, 2)"></center>
                                        </td>
                                        <td><input type="text" class="form-control" id="2iteminvest${i+1}" name="iteminvest2[]" value="${el.item}" onkeyup="this.value = this.value.toUpperCase();"></td>
                                        <td><input type="text" class="form-control text-right" id="2priceinvest${i+1}" name="priceinvest2[]" value="${formatNumberWithCommas(el.price)}" onkeyup="formatInput(this)" onchange="priceInvestment(${i+1}, 2)"></td>
                                        <td><input type="text" class="form-control text-right" id="2totprodinvest${i+1}" name="totprodinvest2[]" value="${formatNumberWithCommas(el.totalprod)}" onkeyup="formatInput(this)" onchange="priceInvestment(${i+1}, 2)"></td>
                                        <td><input type="number" class="form-control text-center" id="2cavityinvest${i+1}" name="cavityinvest2[]" value="${el.quantity}" onchange="priceInvestment(${i+1}, 2)" value="1"></td>
                                        <td><input type="text" class="form-control text-right" id="2rppartinvest${i+1}" name="rppartinvest2[]" value="${formatNumberWithCommas(el.rppart)}" readonly></td>
                                        <td class="dt-center">
                                            <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_investment_2_${i+1}" onclick="deleteRowInvestment('2', '${i+1}')"><i class="fa fa-trash"></i></button></center>
                                        </td>
                                    </tr>`              
                    })
                    tbodyInv2.html(strHtmlInv2);
                    $('.select2').select2({
                        placeholder: "Pilih"
                    });
                }else{
                    resetCogm();
                }
                $('#namadepthead').val(data.approval.nama_depthead);
                $('#emaildepthead').val(data.approval.email_depthead);
                $('#namadivhead').val(data.approval.nama_divhead);
                $('#emaildivhead').val(data.approval.email_divhead);
                $('#namapresdir').val(data.approval.nama_presdir);
                $('#emailpresdir').val(data.approval.email_presdir);
            }
        });
        mode();
    }

    function pdfCogm() {
        let id = $("#nama").val();
        let history = $("#history").val();
        if(id != ''){
            let url = '{% url 'COGM:pdf_cogm' 'param1' 'param2'%}';
            url = url.replace('param1', btoa(id));
            url = url.replace('param2', btoa(history));
            window.open(url, '_blank');
        }else{
            Swal.fire({
                title: 'Warning',
                text: 'Masukan Produk Terlebih Dahulu',
                icon: 'warning'
            })
        }
    }

    function excelCogm() {
        let id = $("#nama").val();
        let history = $("#history").val();
        if(id != ''){
            let url = '{% url 'COGM:excel_cogm' 'param1' 'param2'%}';
            url = url.replace('param1', btoa(id));
            url = url.replace('param2', btoa(history));
            window.open(url, '_blank');
        }else{
            Swal.fire({
                title: 'Warning',
                text: 'Masukan Produk Terlebih Dahulu',
                icon: 'warning'
            })
        }
    }

    function resetCogm() {
        $('#materialcost').val('');
        $('#processcost').val('');
        $('#productcost').val('');
        $('#deprecost').val('');
        $('#nondeprecost').val('');
        $('#maintenancecost').val('');
        $('#trialcost').val('');
        $('#totaldepre').val('');
        $('#rejectpercent').val('');
        $('#rejectcost').val('');
        $('#totalcost').val('');
        $('#ketchange').val('');
        $('#approve').val('');
        $('#approve').css('color', '');
        $("#tbodyComponen1").empty();
        $("#tbodyComponen2").empty();
        $("#tbodyFinishing").empty();
        $("#tbodyAssembly").empty();
        $("#tbodyPackaging").empty();
        $("#tbodyInvestment1").empty();
        $("#tbodyInvestment2").empty();
        // $('#namadepthead').val('');
        // $('#emaildepthead').val('');
    }

    $('.select2').select2({
        placeholder: "Pilih"
    });

    function validate() {
        Swal.fire({
            title: 'Konfirmasi',
            text: 'Apakah Anda yakin ingin mengirimkan formulir?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Ya',
            cancelButtonText: 'Tidak'
        }).then(function(result) {
            if (result.value) {
                $("#loading").show();
                $.ajax({
                    type: "POST",
                    url: "{% url 'COGM:store_cogm' %}",
                    data: $('#form_id').serialize(),
                    success: function(response) {
                        $("#loading").hide();
                        Swal.fire(response.head, response.msg, response.status)
                        .then((result) => {
                            if (result.isConfirmed || result.isDismissed) {
                                window.location.reload();
                            }
                        });
                    }
                });
            }
        });
    };

    function addComponen1() {
        let history = $("#history").val();
        if(history == 'UPD') {
            let row = $('.form-tr-pi').length;
            row = row + 1;
            $('#tbodyComponen1').append(initRowStruk1(row));
            $('.componen').select2({
                placeholder: "Select"
            });
        }else{
            Swal.fire('Warning','Update History Terlebih Dahulu', 'warning');
        }
    };

    function addComponen2() {
        let history = $("#history").val();
        if(history == 'UPD') {
            let row = $('.form-tr-comp').length;
            row = row + 1;
            $('#tbodyComponen2').append(initRowStruk2(row));
            $('.componen').select2({
                placeholder: "Select"
            });
        }else{
            Swal.fire('Warning','Update History Terlebih Dahulu', 'warning');
        }
    };

    function addFinishing() {
        let history = $("#history").val();
        if(history == 'UPD') {
            let row = $('.form-tr-f').length;
            row = row + 1;
            $('#tbodyFinishing').append(initRowProcess('f', row));
        }else{
            Swal.fire('Warning','Update History Terlebih Dahulu', 'warning');
        }
    };

    function addAssembly() {
        let history = $("#history").val();
        if(history == 'UPD') {
            let row = $('.form-tr-a').length;
            row = row + 1;
            $('#tbodyAssembly').append(initRowProcess('a', row));
        }else{
            Swal.fire('Warning','Update History Terlebih Dahulu', 'warning');
        }
    };

    function addPackaging() {
        let history = $("#history").val();
        if(history == 'UPD') {
            let row = $('.form-tr-p').length;
            row = row + 1;
            $('#tbodyPackaging').append(initRowProcess('p', row));
        }else{
            Swal.fire('Warning','Update History Terlebih Dahulu', 'warning');
        }
    };

    function addInvestment1() {
        let history = $("#history").val();
        if(history == 'UPD') {
            let totprod =  $('#quantity').val();
            if(totprod != '') {
                let row = $('.form-tr-investment1').length;
                row = row + 1;
                $('#tbodyInvestment1').append(initRowInvestment(row, totprod, '1'));
            }else{
                Swal.fire('Pilih Product','Pilih Product Terlebih Dahulu', 'warning');
            }
        }else{
            Swal.fire('Warning','Update History Terlebih Dahulu', 'warning');
        }
    };

    function addInvestment2() {
        let history = $("#history").val();
        if(history == 'UPD') {
            let totprod =  $('#quantity').val();
            if(totprod != '') {
                let row = $('.form-tr-investment2').length;
                row = row + 1;
                $('#tbodyInvestment2').append(initRowInvestment(row, totprod, '2'));
            }else{
                Swal.fire('Pilih Product','Pilih Product Terlebih Dahulu', 'warning');
            }
        }else{
            Swal.fire('Warning','Update History Terlebih Dahulu', 'warning');
        }
    };

    function initRowStruk1(row) {
        return `<tr id="tr_pi_${row}" class="form-tr-pi">  
                    <td style="text-align: center;" id="no_picomp${row}">${row}</td>  
                    <td style="width:30%;">
                        <select name="pi[]" id="pi${row}" class="form-control componen" style="width:100%" onchange="calculateCostPi(${row})" required>
                            <option value=""></option>
                            {% for piin in all_piin %}
                                <option value="{{ piin.id_pi_comp}}" cycle_time="{{ piin.cycle_time}}" cost="{{ piin.cost_total}}" mesin="{{ piin.cost_mesin}}" cooling="{{ piin.cost_cooling}}" tonage="{{ piin.tonage}}" process="{{ piin.cost_process}}" material="{{ piin.cost_material}}">{{ piin.nama_pi_comp }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td><input type="text" name="costpi[]" id="costpi${row}" class="form-control text-right" readonly></td>
                    <td class="dt-center">
                        <center><button type="button" class="btn btn-xs btn-primary" id="btndetpi_${row}" onclick="getDetailPI(${row})"><i class="fa fa-info-circle"></i></button></center>
                    </td>
                    <td class="dt-center">
                        <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_pi_${row}" onclick="deleteRowPi(${row})"><i class="fa fa-trash"></i></button></center>
                    </td>
                </tr>`
    }

    function initRowStruk2(row) {
        return `<tr class="form-tr-comp">    
                    <td style="text-align: center;" id="no_comp${row}">${row}</td>
                    <td>
                        <select name="componen[]" id="componen${row}" class="form-control componen" style="width:100%" onchange="calculateCostComponen(${row})" required>
                            <option value=""></option>
                            {% for komp in all_komp %}
                                <option value="{{ komp.id_component}}" cost="{{ komp.rupiah_harga}}" unit="{{ komp.satuan}}" dtmody="{{ komp.dtmody }}">{{ komp.nama_component }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td><input type="text" name="usagec[]" id="usagec${row}" class="form-control text-center" onkeyup="formatInput(this)" autocomplete="off" oninput="calculateCostComponen(${row})" required></td>
                    <td><input type="text" name="unitc[]" id="unitc${row}" class="form-control text-center" readonly></td>
                    <td><input type="text" name="rpunitc[]" id="rpunitc${row}" class="form-control text-right" readonly></td>
                    <td><input type="text" name="rppartc[]" id="rppartc${row}"  class="form-control text-right" readonly></td>
                    <td><input type="text" name="updatec[]" id="updatec${row}"  class="form-control text-right" readonly></td>
                    <td class="dt-center">
                        <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_comp_${row}" onclick="deleteRowComp(${row})"><i class="fa fa-trash"></i></button></center>
                    </td>
                </tr>`
    }

    function initRowProcess(kd, row) {
        return `<tr id="tr_${kd}_${row}" class="form-tr-${kd}">
                    <td style="text-align: center;" id="no_process_${kd}_${row}">${row}</td>     
                    <td><input type="text" name="${kd}process[]" id="${kd}process${row}" class="form-control" autocomplete="off" onkeyup="this.value = this.value.toUpperCase();" required></td>
                    <td><input type="number" name="${kd}mp[]" id="${kd}mp${row}" class="form-control text-center" onchange="costProcess('${kd}', ${row})" required></td>
                    <td><input type="text" name="${kd}ct[]" id="${kd}ct${row}" class="form-control text-center" onkeyup="formatInput(this)" onchange="costProcess('${kd}', ${row})" required></td>
                    <td><input type="text" name="${kd}rpsec[]" id="${kd}rpsec${row}"  class="form-control text-center" onkeyup="formatInput(this)" onchange="costProcess('${kd}', ${row})" required></td>
                    <td><input type="text" name="${kd}rppart[]" id="${kd}rppart${row}"  class="form-control text-right" readonly></td>
                    <td class="dt-center">
                        <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_process_${kd}_${row}" onclick="deleteRowProcess('${kd}', ${row})"><i class="fa fa-trash"></i></button></center>
                    </td>
                </tr>`
    }

    function initRowInvestment(row, totprod, kd) {
        return `<tr class="form-tr-investment${kd}">
                    <input type="hidden" class="form-control" id="${kd}valiteminvest${row}" name="valiteminvest${kd}[]" value="1">
                    <td style="text-align: center;" id="no_investment_${kd}_${row}">${row}</td>     
                    <td class="dt-center">
                        <center><input class="form-control" style="width:60%" type="checkbox" id="${kd}chckitem${row}" name="chckitem${kd}[]" checked onchange="updateCheckboxValue(this, ${row}, ${kd})"></center>
                    </td>
                    <td><input type="text" class="form-control" id="${kd}iteminvest${row}" name="iteminvest${kd}[]" onkeyup="this.value = this.value.toUpperCase();"></td>
                    <td><input type="text" class="form-control text-right" id="${kd}priceinvest${row}" name="priceinvest${kd}[]" onkeyup="formatInput(this)" onchange="priceInvestment(${row}, ${kd})"></td>
                    <td><input type="text" class="form-control text-right" id="${kd}totprodinvest${row}" name="totprodinvest${kd}[]" value="${totprod}" onkeyup="formatInput(this)" onchange="priceInvestment(${row}, ${kd})"></td>
                    <td><input type="number" class="form-control text-center" id="${kd}cavityinvest${row}" name="cavityinvest${kd}[]" onchange="priceInvestment(${row}, ${kd})" value="1"></td>
                    <td><input type="text" class="form-control text-right" id="${kd}rppartinvest${row}" name="rppartinvest${kd}[]" readonly></td>
                    <td class="dt-center">
                        <center><button type="button" class="btn btn-xs btn-danger" id="btn_delete_investment_${kd}_${row}" onclick="deleteRowInvestment('${kd}', '${row}')"><i class="fa fa-trash"></i></button></center>
                    </td>
                </tr>`
    }

    function updateCheckboxValue(checkbox, row, kd) {
        if (checkbox.checked) {
            $(`#${kd}valiteminvest${row}`).val('1');
        } else {
            $(`#${kd}valiteminvest${row}`).val('0');
        }
        calculateCostInvestment();
    }

    function calculateCostPi(row) {
        let selectedOption = $(`#pi${row} option:selected`);
        let cost = parseFloat(selectedOption.attr("cost"));
        $(`#costpi${row}`).val(formatNumberWithCommas(cost.toFixed(2)));
        calculateMaterialCost();
        calculateProcessCost();
    }

    function calculateCostComponen(row) {
        const componenSelect = $(`#componen${row}`);
        const usageInput = $(`#usagec${row}`);
        const unitc = $(`#unitc${row}`);
        const rpunitc = $(`#rpunitc${row}`);
        const rppartc = $(`#rppartc${row}`);
        const updatec = $(`#updatec${row}`);
        
        const selectedcomponenOption = componenSelect.find('option:selected');
        const hargacomponen = parseFloat(selectedcomponenOption.attr('cost'));
        const unit = selectedcomponenOption.attr('unit');
        const usage = parseFloat(usageInput.val());
        const dtmody = selectedcomponenOption.attr('dtmody');
        if (!isNaN(hargacomponen) && !isNaN(usage)) {
            unitc.val(unit);
            rpunitc.val(formatNumberWithCommas(hargacomponen.toFixed(2)));
            const cost = hargacomponen * usage;
            rppartc.val(formatNumberWithCommas(cost.toFixed(2)));
            updatec.val(customDateFormat(dtmody));
        } else {
            unitc.val('');
            rpunitc.val('');
            rppartc.val('');
            updatec.val('');
        }
        calculateMaterialCost();
    }

    function costProcess(kd, row) {
        let mpValue = parseFloat($("#" + kd + "mp" + row).val().replace(/,/g, '')) || 0;
        let ctValue = parseFloat($("#" + kd + "ct" + row).val().replace(/,/g, '')) || 0;
        let rpsecValue = parseFloat($("#" + kd + "rpsec" + row).val().replace(/,/g, '')) || 0;
        let result = mpValue * ctValue * rpsecValue;
        $("#" + kd + "rppart" + row).val(formatNumberWithCommas(result.toFixed(2)));
        calculateProcessCost();
    }

    function priceInvestment(row, kd) {
        let price = parseFloat($("#"+kd+"priceinvest" + row).val().replace(/,/g, '')) || 0;
        let totprod = parseFloat($("#"+kd+"totprodinvest" + row).val().replace(/,/g, '')) || 0;
        let cavity = parseFloat($("#"+kd+"cavityinvest" + row).val().replace(/,/g, '')) || 0;
        let result = (price / totprod) / cavity;
        $("#"+kd+"rppartinvest" + row).val(formatNumberWithCommas(result.toFixed(2)));
        calculateCostInvestment();
    }

    function calculateMaterialCost() {
        let totalMaterialCost = 0;

        // Loop melalui elemen-elemen pi[] dan tambahkan cost_material-nya ke totalMaterialCost
        let piElements = document.getElementsByName("pi[]");
        for (let i = 0; i < piElements.length; i++) {
            let selectedOption = piElements[i].options[piElements[i].selectedIndex];
            let costMaterial = parseFloat(selectedOption.getAttribute("material"));
            if (!isNaN(costMaterial)) {
                totalMaterialCost += costMaterial;
            }
        }

        // Loop melalui elemen-elemen rppartc[] dan tambahkan nilainya ke totalMaterialCost
        let rppartcElements = document.getElementsByName("rppartc[]");
        for (let i = 0; i < rppartcElements.length; i++) {
            let rppartcValue = parseFloat(rppartcElements[i].value.replace(/,/g, ''));
            if (!isNaN(rppartcValue)) {
                totalMaterialCost += rppartcValue;
            }
        }

        // Set nilai totalMaterialCost ke input materialcost
        let materialCostInput = document.getElementById("materialcost");
        materialCostInput.value = formatNumberWithCommas(totalMaterialCost.toFixed(2)); 
        calculateTotalCost();
    }

    function calculateProcessCost() {
        let totalProcessCost = 0;

        $("select[name='pi[]']").each(function() {
            const selectedOption = $(this).find(":selected");
            const costProcess = parseFloat(selectedOption.attr("process"));
            if (!isNaN(costProcess)) {
                totalProcessCost += costProcess;
            }
        });

        const elements = $("input[name='frppart[]'], input[name='arppart[]'], input[name='prppart[]']");
        elements.each(function() {
            const value = $(this).val().replace(/,/g, '');
            if (value) {
                totalProcessCost += parseFloat(value);
            }
        });

        $("#processcost").val(formatNumberWithCommas(totalProcessCost.toFixed(2)));
        calculateTotalCost();
    }

    function calculateCostInvestment() {
        let totalInvestmentCost = 0;
        let totalNonInvestmentCost = 0;

        $("input[name='rppartinvest1[]']").each(function() {
            const checkboxId = $(this).attr('id').replace('rppartinvest', 'chckitem');
            const value = parseFloat($(this).val().replace(/,/g, ''));
            
            if (!isNaN(value)) {
                if ($('#' + checkboxId).is(':checked')) {
                    totalInvestmentCost += value;
                }
            }
        });

        $("input[name='rppartinvest2[]']").each(function() {
            const checkboxId = $(this).attr('id').replace('rppartinvest', 'chckitem');
            const value = parseFloat($(this).val().replace(/,/g, ''));
            
            if (!isNaN(value)) {
                if ($('#' + checkboxId).is(':checked')) {
                    totalInvestmentCost += value;
                }
            }
        });

        $("input[name='priceinvest1[]']").each(function() {
            const checkboxId = $(this).attr('id').replace('priceinvest', 'chckitem');
            const value = parseFloat($(this).val().replace(/,/g, ''));
            
            if (!isNaN(value)) {
                if (!$('#' + checkboxId).is(':checked')) {
                    totalNonInvestmentCost += value;
                }
            }
        });

        $("input[name='priceinvest2[]']").each(function() {
            const checkboxId = $(this).attr('id').replace('priceinvest', 'chckitem');
            const value = parseFloat($(this).val().replace(/,/g, ''));
            if (!isNaN(value)) {
                if (!$('#' + checkboxId).is(':checked')) {
                    totalNonInvestmentCost += value;
                }
            }
        });

        $("#deprecost").val(formatNumberWithCommas(totalInvestmentCost.toFixed(2)));
        $("#nondeprecost").val(formatNumberWithCommas(totalNonInvestmentCost.toFixed(2)));
        calculateCostMaintenance();
        calculateTotalCost();
    }

    function calculateCostMaintenance() {
        let cost = 0;
        let prod = parseFloat($("#quantity").val().replace(/,/g, ''));
        $("input[name='priceinvest1[]']").each(function() {
            const value = parseFloat($(this).val().replace(/,/g, ''));
            if (!isNaN(value)) {
                cost += value * 0.05 / prod;
            }
        });
        if ($('#chckdmaintenance').is(':checked')) {
            cost = cost;
        }else{
            cost = 0;
        }
        $("#maintenancecost").val(formatNumberWithCommas(cost.toFixed(2)));
    }

    function calculateTotalCost() {
        let materialcost =  parseFloat($("#materialcost").val().replace(/,/g, '') || 0);
        let processcost = parseFloat($("#processcost").val().replace(/,/g, '') || 0);
        let deprecost = parseFloat($("#deprecost").val().replace(/,/g, '') || 0);
        let maintenancecost = parseFloat($("#maintenancecost").val().replace(/,/g, '') || 0);
        let productcost = materialcost + processcost;
        let rejectpercent = parseFloat($("#rejectpercent").val().replace(/,/g, '') || 0);
        let rejectcost = productcost * rejectpercent / 100;
        let trialcost = 0;

        if ($('#chckdtrial').is(':checked')) {
            trialcost = (materialcost + processcost + deprecost + maintenancecost) * 5 / 100;
        }

        let totdepre = deprecost + maintenancecost + trialcost;
        total = materialcost + processcost + deprecost + maintenancecost + trialcost + rejectcost;

        $("#productcost").val(formatNumberWithCommas(productcost.toFixed(2)));
        $("#trialcost").val(formatNumberWithCommas(trialcost.toFixed(2)));
        $("#totaldepre").val(formatNumberWithCommas(totdepre.toFixed(2)));
        $("#rejectcost").val(formatNumberWithCommas(rejectcost.toFixed(2)));
        $("#totalcost").val(formatNumberWithCommas(total.toFixed(2)));
    }

    function getDetailPI(row) {
        let id = $(`#pi${row}`).val();
        let history = $(`#history`).val();
        let idprod = $(`#nama`).val();
        if (id !== '') {
            if(history == 'UPD') {
                getDetailPiUpd(id);
            }else{
                getDetailPiHistory(id, history, idprod);
            }
            $('#modalPi').modal('show');
        } else {
            Swal.fire({
                title: 'Warning',
                text: 'Pilih PI Componen Terlebih Dahulu',
                icon: 'warning'
            });
        }
    }

    function getDetailPiHistory(id, history, idprod) {
        let url = '{% url 'COGM:getpihistory_cogm' 'param1' 'param2' 'param3'%}';
        url = url.replace('param1', btoa(id));
        url = url.replace('param2', btoa(history));
        url = url.replace('param3', btoa(idprod));
        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                $('#headpi').text(response.nama_komponen);
                $('#tonnage').val(response.tonnage);
                $('#cycletime').val(response.cycle_time);
                $('#cavitypi').val(response.cavity);
                $('#usagepi').val(response.usage);
                $('#period').val(formatTanggalPeriod(response.period));
                $('#costmesin').val(formatNumberWithCommas(response.cost_mesin));
                $('#costcooling').val(formatNumberWithCommas(response.cost_cooling));
                const bodyTabel=$('#tbodyMaterial')
                let strHtml=""
                response.material_list.forEach((el,i)=>{
                    strHtml+=`
                        <tr>    
                            <td><input type="text" class="form-control" readonly value="${el.nama_raw_material}"></td>
                            <td><input type="text" class="form-control text-center" readonly value="${el.persen}"></td>
                            <td><input type="text" class="form-control" readonly value="${parseFloat(el.usage).toFixed(6)}"></td>
                            <td><input type="text" class="form-control text-right" readonly value="${formatNumberWithCommas(el.harga_kg)}"></td>
                            <td><input type="text" class="form-control text-right" readonly value="${formatNumberWithCommas(el.harga_part)}"></td>
                        </tr>
                    `                    
                })
                bodyTabel.html(strHtml);
            }
        });
    }

    function getDetailPiUpd(id) {
        let url = '{% url 'COGM:get_picomp' 'param1'%}';
        url = url.replace('param1', btoa(id));
        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                $('#headpi').text(response.nama_komponen);
                $('#tonnage').val(response.tonnage);
                $('#cycletime').val(response.cycle_time);
                $('#cavitypi').val(response.cavity);
                $('#usagepi').val(response.usage);
                $('#period').val(formatTanggalPeriod(response.period));
                $('#costmesin').val(formatNumberWithCommas(response.cost_mesin));
                $('#costcooling').val(formatNumberWithCommas(response.cost_cooling));
                const bodyTabel=$('#tbodyMaterial')
                let strHtml=""
                response.material_list.forEach((el,i)=>{
                    strHtml+=`
                        <tr>    
                            <td><input type="text" class="form-control" readonly value="${el.nama_raw_material}"></td>
                            <td><input type="text" class="form-control text-center" readonly value="${el.persen}"></td>
                            <td><input type="text" class="form-control" readonly value="${parseFloat(el.usage).toFixed(6)}"></td>
                            <td><input type="text" class="form-control text-right" readonly value="${formatNumberWithCommas(el.harga_kg)}"></td>
                            <td><input type="text" class="form-control text-right" readonly value="${formatNumberWithCommas(el.harga_part)}"></td>
                        </tr>
                    `                    
                })
                bodyTabel.html(strHtml);
            }
        });
    }

    function deleteRowPi(id) {
        let history = $("#history").val();
        if(history == 'UPD') {
            Swal.fire({
                title: 'Hapus PI Component',
                text: 'Apakah Anda yakin ingin menghapus?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ya',
                cancelButtonText: 'Tidak'
            }).then(function(result) {
                if (result.isConfirmed) {
                    var row_index = id;
                    var jml_row = $('.form-tr-pi').length;
                    document.getElementById('tableAddComponen1').deleteRow(row_index);
                    for (let $i = row_index; $i <= jml_row; $i++) {

                        var no_picomp = "#no_picomp" + $i;
                        var no_picomp_new = "no_picomp" + ($i - 1);
                        $(no_picomp).html($i-1);
                        $(no_picomp).attr({
                            "id": no_picomp_new,
                        });

                        var btn_delete = "#btn_delete_pi_" + $i;
                        var btn_delete_new = "btn_delete_pi_" + ($i - 1);

                        $(btn_delete).attr({
                            "id": btn_delete_new,
                            "onclick": "deleteRowPi(" + ($i - 1) + ")"
                        });
                    }
                    calculateMaterialCost();
                    calculateProcessCost();
                }
            }).catch(swal.noop)
        }else{
            Swal.fire('Warning','Tidak Dapat Hapus, Update History Terlebih Dahulu', 'warning');
        }
    }

    function deleteRowComp(id) {
        let history = $("#history").val();
        if(history == 'UPD') {
            Swal.fire({
                title: 'Hapus Component',
                text: 'Apakah Anda yakin ingin menghapus?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ya',
                cancelButtonText: 'Tidak'
            }).then(function(result) {
                if (result.isConfirmed) {
                    let row_index = id;
                    let jml_row = $('.form-tr-comp').length;
                    document.getElementById('tableAddComponen2').deleteRow(row_index);
                    for (let $i = row_index; $i <= jml_row; $i++) {
                        let no_comp = "#no_comp" + $i;
                        let no_comp_new = "no_comp" + ($i - 1);
                        $(no_comp).html($i-1);
                        $(no_comp).attr({
                            "id": no_comp_new,
                        });

                        let btn_delete = "#btn_delete_comp_" + $i;
                        let btn_delete_new = "btn_delete_comp_" + ($i - 1);

                        $(btn_delete).attr({
                            "id": btn_delete_new,
                            "onclick": "deleteRowComp(" + ($i - 1) + ")"
                        });
                    }
                    calculateMaterialCost();
                }
            }).catch(swal.noop)
        }else{
            Swal.fire('Warning','Tidak Dapat Hapus, Update History Terlebih Dahulu', 'warning');
        }
    }

    function deleteRowProcess(kd, id) {
        let history = $("#history").val();
        if(history == 'UPD') {
            let ket = '';
            if(kd == 'f') {
                ket = 'Finishing'
            } else if(kd == 'a') {
                ket = 'Assembly'
            } else if(kd == 'p') {
                ket = 'Packaging'
            }
            Swal.fire({
                title: 'Hapus Process Cost '+ket,
                text: 'Apakah Anda yakin ingin menghapus?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ya',
                cancelButtonText: 'Tidak'
            }).then(function(result) {
                if (result.isConfirmed) {
                    var row_index = id;
                    var jml_row = $('.form-tr-'+kd).length;
                    document.getElementById('tableAdd' + ket).deleteRow(row_index);
                    for (let $i = row_index; $i <= jml_row; $i++) {

                        var no_process_ = "#no_process_" + kd + "_" + $i;
                        var no_process_new = "no_process_" + kd + "_" + ($i - 1);
                        $(no_process_).html($i-1);
                        $(no_process_).attr({
                            "id": no_process_new,
                        });

                        var btn_delete = "#btn_delete_process_" + kd + "_" + $i;
                        var btn_delete_new = "btn_delete_process_" + kd + "_" + ($i - 1);

                        $(btn_delete).attr({
                            "id": btn_delete_new,
                            "onclick": "deleteRowProcess('" + kd + "', " + ($i - 1) + ")"
                        });
                    }
                    calculateProcessCost();
                }
            }).catch(swal.noop)
        }else{
            Swal.fire('Warning','Update History Terlebih Dahulu', 'warning');
        }
    }

    function deleteRowInvestment(kd, id) {
        let history = $("#history").val();
        if(history == 'UPD') {
            Swal.fire({
                title: 'Hapus Component',
                text: 'Apakah Anda yakin ingin menghapus?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ya',
                cancelButtonText: 'Tidak'
            }).then(function(result) {
                if (result.isConfirmed) {
                    var row_index = id;
                    var jml_row = $('.form-tr-investment'+kd).length;
                    document.getElementById('tableAddInvestment' + kd).deleteRow(row_index);
                    for (let $i = row_index; $i <= jml_row; $i++) {

                        var no_investment_ = "#no_investment_" + kd + "_" + $i;
                        var no_investment_new = "no_investment_" + kd + "_" + ($i - 1);
                        $(no_investment_).html($i-1);
                        $(no_investment_).attr({
                            "id": no_investment_new,
                        });

                        var btn_delete = "#btn_delete_investment_" + kd + "_" + $i;
                        var btn_delete_new = "btn_delete_investment_" + kd + "_" + ($i - 1);

                        $(btn_delete).attr({
                            "id": btn_delete_new,
                            "onclick": "deleteRowInvestment('" + kd + "', '" + ($i - 1) + "')"
                        });
                    }
                    calculateCostInvestment();
                }
            }).catch(swal.noop)
        }else{
            Swal.fire('Warning','Update History Terlebih Dahulu', 'warning');
        }
    }

    function formatInput(inputElement) {
        // Mengambil nilai dari elemen input
        var inputValue = inputElement.value;

        // Mencari indeks titik (.) dalam input
        var dotIndex = inputValue.indexOf('.');

        // Jika ada titik (.) dalam input, hanya memproses bagian sebelum titik
        if (dotIndex !== -1) {
            var integerPart = inputValue.slice(0, dotIndex);
            var decimalPart = inputValue.slice(dotIndex);
            
            // Menghapus semua karakter selain angka di bagian integer
            var cleanedIntegerPart = integerPart.replace(/[^\d]/g, '');
            
            // Mengubah angka yang telah dibersihkan menjadi format dengan koma
            var formattedIntegerPart = formatNumberWithCommas(cleanedIntegerPart);
            
            // Menggabungkan kembali bagian integer yang telah diformat dengan bagian desimal
            var formattedValue = formattedIntegerPart + decimalPart;
        } else {
            // Jika tidak ada titik (.), hanya menghapus karakter selain angka
            var cleanedValue = inputValue.replace(/[^\d]/g, '');
            
            // Mengubah angka yang telah dibersihkan menjadi format dengan koma
            var formattedValue = formatNumberWithCommas(cleanedValue);
        }

        // Memasukkan nilai yang telah diformat kembali ke dalam elemen input
        inputElement.value = formattedValue;
    }

    function formatNumberWithCommas(number) {
        number = parseFloat(number);
        let formattedNumber = number.toFixed(2); // Format angka menjadi dua desimal

        if (formattedNumber.endsWith('.00')) {
            // Jika dua angka dibelakang . adalah 00, hilangkan . dan angka-angka desimalnya
            formattedNumber = formattedNumber.slice(0, -3);
        }

        return formattedNumber.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    function formatTanggal(tanggalWaktuAwal) {
        const tanggalWaktu = new Date(tanggalWaktuAwal);
        const tahun = tanggalWaktu.getFullYear();
        const bulan = tanggalWaktu.toLocaleString('en-US', { month: 'short' });;
        const tanggal = tanggalWaktu.getDate().toString().padStart(2, '0');
        const jam = tanggalWaktu.getHours().toString().padStart(2, '0');
        const menit = tanggalWaktu.getMinutes().toString().padStart(2, '0');
        const detik = tanggalWaktu.getSeconds().toString().padStart(2, '0');
        const tanggalWaktuAkhir = `${tanggal}-${bulan}-${tahun} ${jam}:${menit}:${detik}`;
        return tanggalWaktuAkhir;
    }

    function formatTanggalVal(tanggalWaktuAwal) {
        const tanggalWaktu = new Date(tanggalWaktuAwal);
        const tahun = tanggalWaktu.getFullYear();
        const bulan = (tanggalWaktu.getMonth() + 1).toString().padStart(2, '0');
        const tanggal = tanggalWaktu.getDate().toString().padStart(2, '0');
        const jam = tanggalWaktu.getHours().toString().padStart(2, '0');
        const menit = tanggalWaktu.getMinutes().toString().padStart(2, '0');
        const detik = tanggalWaktu.getSeconds().toString().padStart(2, '0');
        const tanggalWaktuAkhir = `${tanggal}-${bulan}-${tahun} ${jam}:${menit}:${detik}`;
        return tanggalWaktuAkhir;
    }

    function formatTanggalPeriod(tanggalWaktuAwal) {
        const tanggalWaktu = new Date(tanggalWaktuAwal);
        const tahun = tanggalWaktu.getFullYear();
        const bulan = (tanggalWaktu.getMonth() + 1).toString().padStart(2, '0');
        const tanggal = tanggalWaktu.getDate().toString().padStart(2, '0');
        const tanggalWaktuAkhir = `${tanggal}-${bulan}-${tahun}`;
        return tanggalWaktuAkhir;
    }

    function customDateFormat(inputDate) {
        var parts = inputDate.split(/, | /);

        if (parts.length !== 5) {
            return "Format tanggal tidak valid";
        }

        var month = parts[0].replace(/\./g, '');
        var date = parts[1];
        var year = parts[2];
        var time = parts[3].split(":");
        var hour = time[0];
        var minute = time[1];
        var ampm = parts[4];

        if (ampm.toLowerCase() === "p.m." && hour !== "12") {
            hour = (parseInt(hour) + 12).toString();
        } else if (ampm.toLowerCase() === "a.m." && hour === "12") {
            hour = "00";
        }
        var detik = "00";
        if (date.length === 1) {
            date = "0" + date;
        }
        if (hour.length === 1) {
            hour = "0" + hour;
        }
        var outputDate = date + "-" + month + "-" + year + " " + hour + ":" + minute + ":" + detik;
        return outputDate;
    }
    
</script>
{% endblock %}